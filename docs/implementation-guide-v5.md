# 🔧 予約状況自動更新システム v5 実装手順

## 📦 ダウンロードファイル

1. **chrome-extension-v5.zip** - Chrome拡張機能（PC用）
2. **bookmarklet-v6.md** - ブックマークレット（スマホ・PC用）
3. **index-v6.html** - GitHub Pages用バナー

---

## ✨ 新機能（v5/v6）

### 日付判定機能

- **火曜18:30以降** → 木曜日の予約状況をチェック
- **水曜日（終日）** → 木曜日の予約状況をチェック
- **月末18:30以降** → 自動判定不可（フォームから入力を促す）
- **その他18:30以降** → 明日の予約状況をチェック
- **18:30より前** → 本日の予約状況をチェック

### バナー表示の改善

- 「本日分の予約枠」
- 「明日分の予約枠」
- 「木曜分の予約枠」
- 「翌営業日の予約枠」

状況に応じて自動的に表示が変わります。

---

## 🔧 実装手順

### 1. Chrome拡張機能の更新（PC）

#### ステップ1：古い拡張機能を削除

1. Chromeで `chrome://extensions/` を開く
2. 既存の「予約状況自動更新」拡張機能を探す
3. 「削除」ボタンをクリック

#### ステップ2：新しい拡張機能をインストール

1. **chrome-extension-v5.zip** をダウンロード
2. ZIPファイルを解凍
3. `chrome://extensions/` を開く
4. 右上の「デベロッパーモード」をON
5. 「パッケージ化されていない拡張機能を読み込む」をクリック
6. 解凍したフォルダ（`chrome-extension`）を選択
7. 完了！

#### ステップ3：動作確認

1. 予約ページを開く
   - https://ckreserve.com/clinic/fujiminohikari-ganka/fujimino
2. 右下に「🔄 予約状況を更新する」ボタンが表示される
3. ボタンをクリック
4. 「✅ ◯◯分の状態: 空きあり」と表示されたら成功
5. スプレッドシートで記録を確認

---

### 2. ブックマークレットの更新（スマホ・PC）

#### ステップ1：既存のブックマークレットを更新

1. **bookmarklet-v6.md** を開く
2. 中にあるJavaScriptコード全体をコピー
3. ブラウザのブックマーク一覧を開く
4. 既存の「🔄予約更新」を探して編集
5. URLを新しいコードに置き換え
6. 保存

#### ステップ2：動作確認

1. 予約ページを開く
2. ブックマークから「🔄予約更新」をタップ
3. 「✅ 更新完了！◯◯分の状態: 空きあり」と表示されたら成功
4. スプレッドシートで記録を確認

---

### 3. GitHub Pagesの更新（バナー表示）

#### ステップ1：GitHubでファイルを編集

1. GitHubのリポジトリを開く
   - https://github.com/nekonekoganka/reservation-status

2. **index.html** をクリック

3. 鉛筆アイコン（編集）をクリック

4. **index-v6.html** の内容を全てコピー

5. 既存の内容を全て削除して、新しい内容を貼り付け

6. 下にスクロールして「Commit changes」をクリック

7. もう一度「Commit changes」をクリック

#### ステップ2：反映を待つ

1〜2分待つとGitHub Pagesが更新されます

#### ステップ3：動作確認

1. バナーのページを開く
   - https://nekonekoganka.github.io/reservation-status/

2. リロード（F5キー）

3. 表示が以下のように変わっていることを確認：
   - 火曜18:30以降・水曜日 → 「木曜分の予約枠」
   - 月末18:30以降 → 「翌営業日の予約枠」
   - その他18:30以降 → 「明日分の予約枠」
   - 18:30より前 → 「本日分の予約枠」

---

## 🧪 テストケース

### テスト1：火曜日 19:00

**期待される動作：**
1. ボタンをクリック
2. カレンダーで木曜日（例：7日）をチェック
3. ボタンに「✅ 木曜分: 空きあり」と表示
4. スプレッドシートに記録
5. バナーに「✅ 木曜分の予約枠 空きあり」と表示

### テスト2：水曜日 14:00

**期待される動作：**
1. ボタンをクリック
2. カレンダーで木曜日をチェック
3. ボタンに「✅ 木曜分: 空きあり」と表示
4. バナーに「✅ 木曜分の予約枠 空きあり」と表示

### テスト3：月末（11/30）19:00

**期待される動作：**
1. ボタンをクリック
2. 「⚠️ 月末のため自動判定できません」と表示
3. Googleフォームから手動入力を促す
4. バナーには最後にフォームから入力された状態が表示
5. 表示文言は「✅ 翌営業日の予約枠 空きあり」

### テスト4：月曜日 10:00

**期待される動作：**
1. ボタンをクリック
2. カレンダーで本日（月曜）をチェック
3. ボタンに「✅ 本日分: 空きあり」と表示
4. バナーに「✅ 本日分の予約枠 空きあり」と表示

---

## ⚠️ トラブルシューティング

### Chrome拡張機能がボタンを表示しない

- ページを再読み込み（F5キー）
- 拡張機能が有効になっているか確認（`chrome://extensions/`）
- 予約ページのURLが正しいか確認

### ボタンをクリックしてもスプレッドシートに記録されない

- Google Apps Scriptが正しくデプロイされているか確認
- スプレッドシートIDが正しいか確認
- ブラウザのコンソールでエラーを確認（F12キー）

### バナーの表示が古いまま

- ブラウザのキャッシュをクリア
- スーパーリロード（Ctrl+Shift+R）
- GitHub Pagesの反映を待つ（1〜2分）

### 月末でないのに「月末のため自動判定不可」と表示される

- 日付の計算ロジックを確認
- ブラウザの日時設定を確認

---

## 📝 運用方法

### 日常の使い方

#### PCの場合
1. 予約ページを開く
2. 右下のボタンを1クリック
3. 完了！（2秒）

#### スマホの場合
1. 予約ページを開く
2. ブックマークから「🔄予約更新」をタップ
3. 完了！（2秒）

### 月末の場合（特別対応）
1. Googleフォームを開く
2. 手動で「空きあり」or「満」を選択
3. 送信
4. バナーに自動反映（1分以内）

---

## 🎉 完成！

これで、曜日と時間に応じて適切な日付をチェックするシステムが完成しました！

何か問題があれば、いつでもご連絡ください。😊
