<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºˆç´„çŠ¶æ³ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ - ãµã˜ã¿é‡ã²ã‹ã‚Šçœ¼ç§‘</title>
    <style>
        /* å…¨ç”»é¢è¡¨ç¤ºç”¨ã®ãƒªã‚»ãƒƒãƒˆ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            overflow: hidden;
        }

        .display-area {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        /* ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .display-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 80px;
            text-align: center;
            color: white;
            transition: background-color 0.5s ease;
        }

        /* äºˆç´„å¯èƒ½ã®æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆæ¿ƒã„é»„ç·‘è‰²ï¼‰ - èƒŒæ™¯è‰²ã¯JSã§å‹•çš„ã«è¨­å®š */
        .display-container.available {
            /* background color set by JavaScript */
        }

        /* äºˆç´„ä¸å¯ã®æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆèµ¤è‰²ï¼‰ - èƒŒæ™¯è‰²ã¯JSã§å‹•çš„ã«è¨­å®š */
        .display-container.unavailable {
            /* background color set by JavaScript */
        }

        /* èª­ã¿è¾¼ã¿ä¸­ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .display-container.loading {
            background: #6C757D;
        }

        /* ã‚¯ãƒªãƒ‹ãƒƒã‚¯åï¼ˆä½¿ç”¨ã—ãªã„ï¼‰ */
        .clinic-name {
            display: none;
        }

        :root {
            --pulse-duration: 3s;
        }

        /* ã‚¢ã‚¤ã‚³ãƒ³ */
        .icon {
            font-size: clamp(144px, 12vw, 200px);
            margin-bottom: 95px;
            margin-top: 80px;
            line-height: 1;
            animation: pulse var(--pulse-duration) ease-in-out infinite;
            /* text-shadow is set by JavaScript based on DISPLAY_CONFIG */
        }

        /* ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.15);
            }
            100% {
                transform: scale(1);
            }
        }

        /* ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆç©ºãã‚ã‚Š/æº€æ ï¼‰ */
        .main-message {
            font-size: clamp(60px, 6vw, 120px);
            font-weight: 900;
            margin-bottom: 60px;
            line-height: 1.2;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            animation: fadeIn 1s ease-in;
        }


        /* ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ã‚µãƒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .sub-message {
            font-size: clamp(41px, 4.1vw, 56px);
            margin-bottom: 5px;
            line-height: 1.6;
            opacity: 0.95;
        }

        /* QRã‚³ãƒ¼ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .qr-message {
            font-size: clamp(46px, 4.6vw, 64px);
            font-weight: 400;
            margin-top: 0;
            margin-bottom: 60px;
            opacity: 0.95;
        }

        /* æ›´æ–°æ™‚åˆ» */
        .update-time {
            font-size: clamp(30px, 3vw, 40px);
            opacity: 0.85;
            margin-top: 0;
        }

        /* ã‚¨ãƒ©ãƒ¼æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .display-container.error {
            background: linear-gradient(135deg, #868E96 0%, #6C757D 100%);
        }

        .error-message {
            font-size: clamp(36px, 4vw, 72px);
            margin-top: 40px;
        }

        /* æ˜¼ä¼‘ã¿ãƒãƒŠãƒ¼ */
        .lunch-break-banner {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background: #ffc107;
            color: #212529;
            font-size: clamp(16px, 2.8vw, 32px);
            font-weight: bold;
            text-align: center;
            padding: 0 20px;
            height: 115px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
        }

        .lunch-break-banner.show {
            display: block;
        }

        /* QRã‚³ãƒ¼ãƒ‰ï¼ˆå·¦ä¸‹å›ºå®šï¼‰ */
        .qr-code-corner {
            position: absolute;
            bottom: 30px;
            left: 20px;
            z-index: 1200;
        }

        .qr-code-corner img {
            display: block;
        }
    </style>
</head>
<body>
<div class="display-area">
    <!-- å–¶æ¥­æ™‚é–“å‰ãƒãƒŠãƒ¼ -->
    <div id="openingSoonBanner" class="lunch-break-banner"></div>

    <!-- æ˜¼ä¼‘ã¿ãƒãƒŠãƒ¼ -->
    <div id="lunchBreakBanner" class="lunch-break-banner"></div>

    <!-- QRã‚³ãƒ¼ãƒ‰ï¼ˆå·¦ä¸‹å›ºå®šï¼‰ -->
    <div id="qrCodeCorner" class="qr-code-corner">
        <img id="qrImage" src="" alt="äºˆç´„QRã‚³ãƒ¼ãƒ‰">
    </div>

    <div id="displayContainer" class="display-container loading">
        <div class="clinic-name">ãµã˜ã¿é‡ã²ã‹ã‚Šçœ¼ç§‘</div>
        <div class="icon">â³</div>
        <div class="main-message">èª­ã¿è¾¼ã¿ä¸­...</div>
        <div class="sub-message">äºˆç´„çŠ¶æ³ã‚’ç¢ºèªã—ã¦ã„ã¾ã™</div>
    </div>
</div>

<script>
    // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ID
    const SPREADSHEET_ID = '1RSd9aC5B_-gQ1_j5V1aQcZn1iVw9v8mpmhJ78_8gY80';

    // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã‚·ãƒ¼ãƒˆå
    const SHEET_NAME = 'ãƒ•ã‚©ãƒ¼ãƒ ã®å›ç­” 1';

    // Google Sheets APIã®URL
    const API_URL = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;

    const DISPLAY_CONFIG = {
        clinicName: 'ãµã˜ã¿é‡ã²ã‹ã‚Šçœ¼ç§‘',
        availableMsg: '{day}åˆ†ã®äºˆç´„æ  ã€Œç©ºãã€ã‚ã‚Š',
        fullMsg: '{day}ã®äºˆç´„ã¯ ã€Œæº€æ ã€ã§ã™',
        subMsg: 'å¤§å¤‰ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“',
        qrMsg: 'ã”äºˆç´„ã¯ å—ä»˜çª“å£ ã‚‚ã—ãã¯ QRã‚³ãƒ¼ãƒ‰ã‹ã‚‰ ãŠé¡˜ã„è‡´ã—ã¾ã™',
        availableIcon: 'â­•',
        fullIcon: 'ğŸ˜”',
        availableBg: '#27ae60',
        fullBg: '#dc3545',
        bannerBg: '#ffc107',
        bannerText: '#212529',
        iconSize: 12,
        mainMsgSize: 6,
        subMsgSize: 4.1,
        qrMsgSize: 4.6,
        updateTimeSize: 3,
        openingSoonText: '10æ™‚ã«çª“å£ãŒé–‹ãã¾ã™ã€€ãŠå¾…ã¡ä¸‹ã•ã„',
        lunchBreakText: 'æ˜¼ä¼‘ã¿ä¸­ã€€åˆå¾Œï¼“æ™‚ã‚ˆã‚Šçª“å£ãŒé–‹ãã¾ã™',
        bannerFontSize: 3.6,
        bannerHeight: 100,
        bannerPadding: 0,
        iconToMainGap: 95,
        mainToSubGap: 20,
        subToQrGap: 5,
        qrToUpdateGap: 60,
        mainMsgFontWeight: 900,
        subMsgFontWeight: 400,
        qrMsgFontWeight: 400,
        updateTimeFontWeight: 400,
        mainMsgLineHeight: 1.2,
        mainMsgLetterSpacing: 0,
        textShadowEnabled: true,
        textShadowColor: '#000000',
        textShadowBlur: 5,
        textShadowDistance: 3,
        textStrokeEnabled: false,
        textStrokeColor: '#ffffff',
        textStrokeWidth: 2,
        qrEnabled: true,
        qrSize: 175,
        qrPosition: 'top-left',
        qrOpacity: 1,
        qrBorderRadius: 10,
        qrShadowEnabled: true,
        qrImageUrl: 'Downloads/QR_fujiminohikari.png',
        pulseEnabled: true,
        pulseSpeed: 3,
        pulseScale: 1.15,
        glowEnabled: false,
        glowIntensity: 'weak',
        glowColor: 'yellow',
        glowPulse: false,
        floatTarget: 'off',
        floatSpeed: 'slow',
        zoomTarget: 'icon',
        zoomSpeed: 'normal',
        sparkleEnabled: false,
        neonEnabled: false,
        neonSpeed: 'normal',
        screenEffect: 'none',
        gradientEnabled: false,
        gradientType: 'diagonal',
        gradientColor1: '#27ae60',
        gradientColor2: '#1e8449',
        gradientAnimEnabled: false
    };

    const FAVICON_CONFIG = {
        enabled: true,
        availableIcon: 'OK',
        availableColor: '#4CAF50',
        fullIcon: 'âœ•',
        fullColor: '#F44336'
    };

    /**
     * åˆæœŸè¨­å®šã‚’é©ç”¨
     */
    function applyInitialSettings() {
        // ãƒãƒŠãƒ¼ãƒ†ã‚­ã‚¹ãƒˆã¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨­å®š
        const openingSoonBanner = document.getElementById('openingSoonBanner');
        const lunchBreakBanner = document.getElementById('lunchBreakBanner');

        openingSoonBanner.textContent = DISPLAY_CONFIG.openingSoonText;
        lunchBreakBanner.textContent = DISPLAY_CONFIG.lunchBreakText;

        // ãƒãƒŠãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
        [openingSoonBanner, lunchBreakBanner].forEach(banner => {
            banner.style.backgroundColor = DISPLAY_CONFIG.bannerBg;
            banner.style.color = DISPLAY_CONFIG.bannerText;
            banner.style.fontSize = `clamp(16px, ${DISPLAY_CONFIG.bannerFontSize}vw, 32px)`;
            banner.style.height = DISPLAY_CONFIG.bannerHeight + 'px';
            banner.style.padding = DISPLAY_CONFIG.bannerPadding + 'px 20px';
        });

        // QRç”»åƒã‚’è¨­å®š
        const qrImage = document.getElementById('qrImage');
        const qrCodeCorner = document.getElementById('qrCodeCorner');

        if (DISPLAY_CONFIG.qrEnabled) {
            qrImage.src = DISPLAY_CONFIG.qrImageUrl;
            qrImage.style.width = DISPLAY_CONFIG.qrSize + 'px';
            qrImage.style.height = DISPLAY_CONFIG.qrSize + 'px';
            qrImage.style.opacity = DISPLAY_CONFIG.qrOpacity;
            qrImage.style.borderRadius = DISPLAY_CONFIG.qrBorderRadius + 'px';

            if (DISPLAY_CONFIG.qrShadowEnabled) {
                qrImage.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.3)';
            }

            // QRä½ç½®ã‚’è¨­å®š
            switch (DISPLAY_CONFIG.qrPosition) {
                case 'top-left':
                    qrCodeCorner.style.top = '20px';
                    qrCodeCorner.style.left = '20px';
                    qrCodeCorner.style.bottom = 'auto';
                    qrCodeCorner.style.right = 'auto';
                    break;
                case 'top-right':
                    qrCodeCorner.style.top = '20px';
                    qrCodeCorner.style.right = '20px';
                    qrCodeCorner.style.bottom = 'auto';
                    qrCodeCorner.style.left = 'auto';
                    break;
                case 'bottom-right':
                    qrCodeCorner.style.bottom = '20px';
                    qrCodeCorner.style.right = '20px';
                    qrCodeCorner.style.top = 'auto';
                    qrCodeCorner.style.left = 'auto';
                    break;
                default: // bottom-left
                    qrCodeCorner.style.bottom = '20px';
                    qrCodeCorner.style.left = '20px';
                    qrCodeCorner.style.top = 'auto';
                    qrCodeCorner.style.right = 'auto';
            }
        } else {
            qrCodeCorner.style.display = 'none';
        }

        // ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®é€Ÿåº¦ã¨ã‚¹ã‚±ãƒ¼ãƒ«ã‚’å‹•çš„ã«è¨­å®š
        if (DISPLAY_CONFIG.pulseEnabled) {
            const styleSheet = document.styleSheets[0];
            const pulseKeyframes = `
                @keyframes pulse {
                    0% { transform: scale(1); }
                    50% { transform: scale(${DISPLAY_CONFIG.pulseScale}); }
                    100% { transform: scale(1); }
                }
            `;
            // æ—¢å­˜ã®pulseã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç½®ãæ›ãˆ
            for (let i = styleSheet.cssRules.length - 1; i >= 0; i--) {
                if (styleSheet.cssRules[i].name === 'pulse') {
                    styleSheet.deleteRule(i);
                }
            }
            styleSheet.insertRule(pulseKeyframes, styleSheet.cssRules.length);

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦ã‚’è¨­å®š
            document.documentElement.style.setProperty('--pulse-duration', DISPLAY_CONFIG.pulseSpeed + 's');
        }
    }

    /**
     * äºˆç´„çŠ¶æ³ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹é–¢æ•°
     */
    async function updateReservationStatus() {
        const container = document.getElementById('displayContainer');

        try {
            // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const response = await fetch(API_URL);
            const text = await response.text();

            // JSONãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºï¼ˆGoogleç‰¹æœ‰ã®å½¢å¼ï¼‰
            const json = JSON.parse(text.substring(47).slice(0, -2));

            // ãƒ‡ãƒ¼ã‚¿ã®è¡Œã‚’å–å¾—
            const rows = json.table.rows;

            if (rows.length === 0) {
                throw new Error('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
            }

            // å…¨ã¦ã®è¡Œã‹ã‚‰æœ€æ–°ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æ¢ã™
            let latestRow = null;
            let latestDate = null;

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                if (row.c && row.c[0] && row.c[0].v) {
                    // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
                    const timestampStr = row.c[0].f || row.c[0].v;
                    const date = new Date(timestampStr);

                    if (!latestDate || date > latestDate) {
                        latestDate = date;
                        latestRow = row;
                    }
                }
            }

            if (!latestRow) {
                throw new Error('æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
            }

            const timestamp = latestRow.c[0].f; // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ï¼‰
            const status = latestRow.c[1].v; // äºˆç´„çŠ¶æ³ï¼ˆã€Œç©ºãã‚ã‚Šã€orã€Œã€Œæº€ã€ã€ï¼‰

            // äºˆç´„å¯èƒ½ã‹ã©ã†ã‹ã‚’åˆ¤å®šï¼ˆã€Œç©ºãã‚ã‚Šã€ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼‰
            const isAvailable = status.includes('ç©ºãã‚ã‚Š');

            // ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã‚’æ›´æ–°
            displayStatus(isAvailable, timestamp);

        } catch (error) {
            console.error('ã‚¨ãƒ©ãƒ¼:', error);
            displayError();
        }
    }

    /**
     * SVGãƒ•ã‚¡ãƒ“ã‚³ãƒ³ã‚’ç”Ÿæˆ
     */
    function generateFaviconSVG(isAvailable) {
        const icon = isAvailable ? FAVICON_CONFIG.availableIcon : FAVICON_CONFIG.fullIcon;
        const color = isAvailable ? FAVICON_CONFIG.availableColor : FAVICON_CONFIG.fullColor;

        return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
            <rect width="32" height="32" fill="${color}"/>
            <text x="16" y="16" font-size="20" text-anchor="middle" dominant-baseline="central" fill="white"
                font-family="Arial, sans-serif" font-weight="bold">${icon}</text>
        </svg>`;
    }

    /**
     * ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ã‚’æ›´æ–°
     */
    function updateFavicon(isAvailable) {
        if (!FAVICON_CONFIG.enabled) {
            return;
        }

        const svg = generateFaviconSVG(isAvailable);
        const base64 = btoa(unescape(encodeURIComponent(svg)));
        const faviconUrl = `data:image/svg+xml;base64,${base64}`;

        let link = document.querySelector('link[rel="icon"]');
        if (!link) {
            link = document.createElement('link');
            link.rel = 'icon';
            link.type = 'image/svg+xml';
            document.head.appendChild(link);
        }

        link.href = faviconUrl;
    }

    /**
     * ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã€Œæ›´æ–°ï¼šYYYY/MM/DD HH:MMã€å½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
     */
    function formatTimestamp(timestampStr) {
        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ãƒ‘ãƒ¼ã‚¹
        const date = new Date(timestampStr);

        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');

        return `æ›´æ–°ï¼š${year}/${month}/${day} ${hours}:${minutes}`;
    }

    /**
     * æ—¥ä»˜ãƒ†ã‚­ã‚¹ãƒˆã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
     */
    function calculateDayText(updateTime) {
        const now = new Date(updateTime);
        const dayOfWeek = now.getDay(); // 0=æ—¥, 1=æœˆ, 2=ç«, 3=æ°´...
        const hour = now.getHours();
        const minute = now.getMinutes();
        const isAfter1830 = (hour > 18) || (hour === 18 && minute >= 30);

        let dayText = 'æœ¬æ—¥';

        if (isAfter1830) {
            // 18:30ä»¥é™

            // æœˆæœ«ãƒã‚§ãƒƒã‚¯
            const lastDayOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            if (now.getDate() === lastDayOfMonth) {
                dayText = 'ç¿Œè¨ºç™‚æ—¥';
            } else if (dayOfWeek === 2) {
                // ç«æ›œæ—¥
                dayText = 'æœ¨æ›œ';
            } else {
                dayText = 'æ˜æ—¥';
            }
        } else {
            // 18:30ã‚ˆã‚Šå‰
            if (dayOfWeek === 3) {
                // æ°´æ›œæ—¥
                dayText = 'æœ¨æ›œ';
            } else {
                dayText = 'æœ¬æ—¥';
            }
        }

        return dayText;
    }

    /**
     * å–¶æ¥­æ™‚é–“å‰åˆ¤å®šé–¢æ•°ï¼ˆ8:00-10:00ã€å–¶æ¥­æ—¥ã®ã¿ï¼‰
     */
    function isOpeningSoon(updateTime) {
        const now = new Date(updateTime);
        const dayOfWeek = now.getDay(); // 0=æ—¥, 1=æœˆ, 2=ç«, 3=æ°´...
        const hour = now.getHours();

        // æ°´æ›œæ—¥ï¼ˆä¼‘è¨ºæ—¥ï¼‰ã¯è¡¨ç¤ºã—ãªã„
        if (dayOfWeek === 3) {
            return false;
        }

        // 8:00-9:59ã®é–“
        return hour >= 8 && hour < 10;
    }

    /**
     * æ˜¼ä¼‘ã¿åˆ¤å®šé–¢æ•°ï¼ˆ13:30-15:00ã€å–¶æ¥­æ—¥ã®ã¿ï¼‰
     */
    function isLunchBreak(updateTime) {
        const now = new Date(updateTime);
        const dayOfWeek = now.getDay();
        const hour = now.getHours();
        const minute = now.getMinutes();

        // æ°´æ›œæ—¥ï¼ˆä¼‘è¨ºæ—¥ï¼‰ã¯è¡¨ç¤ºã—ãªã„
        if (dayOfWeek === 3) {
            return false;
        }

        // 13:30-15:00ã®é–“
        return (hour === 13 && minute >= 30) || (hour === 14);
    }

    /**
     * ãƒãƒŠãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’æ›´æ–°
     */
    function updateBanners(updateTime) {
        const openingSoonBanner = document.getElementById('openingSoonBanner');
        const lunchBreakBanner = document.getElementById('lunchBreakBanner');

        // å–¶æ¥­æ™‚é–“å‰ãƒãƒŠãƒ¼
        if (isOpeningSoon(updateTime)) {
            openingSoonBanner.classList.add('show');
        } else {
            openingSoonBanner.classList.remove('show');
        }

        // æ˜¼ä¼‘ã¿ãƒãƒŠãƒ¼
        if (isLunchBreak(updateTime)) {
            lunchBreakBanner.classList.add('show');
        } else {
            lunchBreakBanner.classList.remove('show');
        }
    }

    /**
     * ãƒ†ã‚­ã‚¹ãƒˆã‚·ãƒ£ãƒ‰ã‚¦ã¨ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç”Ÿæˆ
     */
    function generateTextStyle() {
        const shadows = [];

        // ãƒ†ã‚­ã‚¹ãƒˆã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ï¼ˆç¸å–ã‚Šï¼‰
        if (DISPLAY_CONFIG.textStrokeEnabled) {
            const width = DISPLAY_CONFIG.textStrokeWidth;
            const color = DISPLAY_CONFIG.textStrokeColor;
            // è¤‡æ•°æ–¹å‘ã®text-shadowã§ç¸å–ã‚Šã‚’å®Ÿç¾
            for (let angle = 0; angle < 360; angle += 45) {
                const rad = (angle * Math.PI) / 180;
                const x = Math.round(Math.cos(rad) * width);
                const y = Math.round(Math.sin(rad) * width);
                shadows.push(`${x}px ${y}px 0 ${color}`);
            }
        }

        // ãƒ†ã‚­ã‚¹ãƒˆã‚·ãƒ£ãƒ‰ã‚¦
        if (DISPLAY_CONFIG.textShadowEnabled) {
            const dx = DISPLAY_CONFIG.textShadowDistance;
            const blur = DISPLAY_CONFIG.textShadowBlur;
            const color = DISPLAY_CONFIG.textShadowColor;
            shadows.push(`0 ${dx}px ${blur}px ${color}`);
        }

        if (shadows.length > 0) {
            return `text-shadow: ${shadows.join(', ')}`;
        }

        return '';
    }

    /**
     * ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
     */
    function displayStatus(isAvailable, updateTime) {
        const container = document.getElementById('displayContainer');

        // ãƒãƒŠãƒ¼ã‚’æ›´æ–°
        updateBanners(updateTime);

        // æ—¥ä»˜ãƒ†ã‚­ã‚¹ãƒˆã‚’è¨ˆç®—
        const dayText = calculateDayText(updateTime);

        // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        const formattedTime = formatTimestamp(updateTime);

        // ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç”Ÿæˆ
        const textStyle = generateTextStyle();

        // èƒŒæ™¯è‰²ã‚’è¨­å®š
        const bgColor = isAvailable ? DISPLAY_CONFIG.availableBg : DISPLAY_CONFIG.fullBg;

        if (isAvailable) {
            // äºˆç´„å¯èƒ½ï¼ˆæ¿ƒã„é»„ç·‘è‰²ï¼‰
            container.className = 'display-container available';
            container.style.backgroundColor = bgColor;
            container.innerHTML = `
                <div class="clinic-name">${DISPLAY_CONFIG.clinicName}</div>
                <div class="icon" style="${textStyle}; margin-bottom: ${DISPLAY_CONFIG.iconToMainGap}px;">${DISPLAY_CONFIG.availableIcon}</div>
                <div class="main-message" style="${textStyle}; font-weight: ${DISPLAY_CONFIG.mainMsgFontWeight}; line-height: ${DISPLAY_CONFIG.mainMsgLineHeight}; letter-spacing: ${DISPLAY_CONFIG.mainMsgLetterSpacing}px; margin-bottom: ${DISPLAY_CONFIG.subToQrGap}px;">${DISPLAY_CONFIG.availableMsg.replace('{day}', dayText)}</div>
                <div class="qr-message" style="${textStyle}; font-weight: ${DISPLAY_CONFIG.qrMsgFontWeight}; margin-bottom: ${DISPLAY_CONFIG.qrToUpdateGap}px;">${DISPLAY_CONFIG.qrMsg}</div>
                <div class="update-time" style="${textStyle}; font-weight: ${DISPLAY_CONFIG.updateTimeFontWeight}">${formattedTime}</div>
            `;
        } else {
            // äºˆç´„ä¸å¯ï¼ˆèµ¤è‰²ï¼‰
            container.className = 'display-container unavailable';
            container.style.backgroundColor = bgColor;
            container.innerHTML = `
                <div class="clinic-name">${DISPLAY_CONFIG.clinicName}</div>
                <div class="icon" style="${textStyle}; margin-bottom: ${DISPLAY_CONFIG.iconToMainGap}px;">${DISPLAY_CONFIG.fullIcon}</div>
                <div class="main-message" style="${textStyle}; font-weight: ${DISPLAY_CONFIG.mainMsgFontWeight}; line-height: ${DISPLAY_CONFIG.mainMsgLineHeight}; letter-spacing: ${DISPLAY_CONFIG.mainMsgLetterSpacing}px; margin-bottom: ${DISPLAY_CONFIG.mainToSubGap}px;">${DISPLAY_CONFIG.fullMsg.replace('{day}', dayText)}</div>
                <div class="sub-message" style="${textStyle}; font-weight: ${DISPLAY_CONFIG.subMsgFontWeight}; margin-bottom: ${DISPLAY_CONFIG.subToQrGap}px;">${DISPLAY_CONFIG.subMsg}</div>
                <div class="qr-message" style="${textStyle}; font-weight: ${DISPLAY_CONFIG.qrMsgFontWeight}; margin-bottom: ${DISPLAY_CONFIG.qrToUpdateGap}px;">${DISPLAY_CONFIG.qrMsg}</div>
                <div class="update-time" style="${textStyle}; font-weight: ${DISPLAY_CONFIG.updateTimeFontWeight}">${formattedTime}</div>
            `;
        }

        updateFavicon(isAvailable);
    }

    /**
     * ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã™ã‚‹é–¢æ•°
     */
    function displayError() {
        const container = document.getElementById('displayContainer');
        container.className = 'display-container error';
        container.innerHTML = `
            <div class="clinic-name">ãµã˜ã¿é‡ã²ã‹ã‚Šçœ¼ç§‘</div>
            <div class="icon">âš ï¸</div>
            <div class="main-message">æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“</div>
            <div class="error-message">ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„</div>
        `;

        updateFavicon(false);
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
    applyInitialSettings();
    updateFavicon(true);
    updateReservationStatus();

    // 1åˆ†ã”ã¨ã«è‡ªå‹•æ›´æ–°ï¼ˆ60000ãƒŸãƒªç§’ = 1åˆ†ï¼‰
    setInterval(updateReservationStatus, 60000);
</script>

</body>
</html>
