<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒãƒƒã‚° - äºˆç´„ç©ºãæ™‚é–“ - ãµã˜ã¿é‡ã²ã‹ã‚Šçœ¼ç§‘</title>
    <style>
        /* å…¨ç”»é¢è¡¨ç¤ºç”¨ã®ãƒªã‚»ãƒƒãƒˆ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            overflow: hidden;
        }

        .display-area {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        /* ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .display-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 80px;
            text-align: center;
            color: white;
            transition: background-color 0.5s ease;
        }

        /* äºˆç´„å¯èƒ½ã®æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆæ¿ƒã„é»„ç·‘è‰²ï¼‰ */
        .display-container.available {
            background: #27ae60;
        }

        /* äºˆç´„ä¸å¯ã®æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆèµ¤è‰²ï¼‰ */
        .display-container.unavailable {
            background: #dc3545;
        }

        /* èª­ã¿è¾¼ã¿ä¸­ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .display-container.loading {
            background: #6C757D;
        }

        /* ã‚¨ãƒ©ãƒ¼æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .display-container.error {
            background: linear-gradient(135deg, #868E96 0%, #6C757D 100%);
        }

        :root {
            --pulse-duration: 3s;
        }

        /* ã‚¢ã‚¤ã‚³ãƒ³ */
        .icon {
            font-size: clamp(144px, 12vw, 200px);
            margin-bottom: 95px;
            margin-top: 80px;
            line-height: 1;
            animation: pulse var(--pulse-duration) ease-in-out infinite;
            text-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
        }

        /* ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.15);
            }
            100% {
                transform: scale(1);
            }
        }

        /* ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆæ™‚é–“æ è¡¨ç¤ºï¼‰ */
        .main-message {
            font-size: clamp(60px, 6vw, 120px);
            font-weight: 900;
            margin-bottom: 20px;
            line-height: 1.2;
            text-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
            animation: fadeIn 1s ease-in;
        }

        /* æ™‚é–“æ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .timeslots {
            font-size: clamp(70px, 7vw, 140px);
            font-weight: 900;
            margin-bottom: 20px;
            line-height: 1.3;
            text-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
            letter-spacing: 0.02em;
        }

        /* ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ã‚µãƒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .sub-message {
            font-size: clamp(41px, 4.1vw, 56px);
            margin-bottom: 5px;
            line-height: 1.6;
            opacity: 0.95;
            text-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
        }

        /* QRã‚³ãƒ¼ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .qr-message {
            font-size: clamp(46px, 4.6vw, 64px);
            font-weight: 400;
            margin-top: 0;
            margin-bottom: 60px;
            opacity: 0.95;
            text-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
        }

        /* æ›´æ–°æ™‚åˆ» */
        .update-time {
            font-size: clamp(30px, 3vw, 40px);
            opacity: 0.85;
            margin-top: 0;
            text-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
        }

        .error-message {
            font-size: clamp(36px, 4vw, 72px);
            margin-top: 40px;
            text-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
        }

        /* æ˜¼ä¼‘ã¿ãƒãƒŠãƒ¼ãƒ»å–¶æ¥­æ™‚é–“å‰ãƒãƒŠãƒ¼ */
        .lunch-break-banner {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background: #ffc107;
            color: #212529;
            font-size: clamp(16px, 3.6vw, 32px);
            font-weight: bold;
            text-align: center;
            padding: 0 20px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
        }

        .lunch-break-banner.show {
            display: flex;
        }

        /* QRã‚³ãƒ¼ãƒ‰ï¼ˆå·¦ä¸‹å›ºå®šï¼‰ */
        .qr-code-corner {
            position: absolute;
            bottom: 30px;
            left: 20px;
            z-index: 1200;
        }

        .qr-code-corner img {
            display: block;
            width: 175px;
            height: 175px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
        .debug-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 350px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px;
            overflow-y: auto;
            z-index: 10000;
            font-size: 14px;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.5);
        }

        .debug-panel h2 {
            font-size: 18px;
            margin-bottom: 15px;
            border-bottom: 2px solid #27ae60;
            padding-bottom: 8px;
        }

        .debug-panel h3 {
            font-size: 16px;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #27ae60;
        }

        .debug-panel label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .debug-panel input,
        .debug-panel select,
        .debug-panel textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 4px;
            font-family: inherit;
        }

        .debug-panel textarea {
            min-height: 80px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .debug-panel button {
            padding: 10px 15px;
            margin: 5px 5px 5px 0;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .debug-panel button:hover {
            background: #229954;
        }

        .debug-panel button.secondary {
            background: #6C757D;
        }

        .debug-panel button.secondary:hover {
            background: #5a6268;
        }

        .debug-panel button.danger {
            background: #dc3545;
        }

        .debug-panel button.danger:hover {
            background: #c82333;
        }

        .toggle-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 10001;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .toggle-panel:hover {
            background: rgba(0, 0, 0, 0.95);
        }

        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px 5px 5px 0;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        .status-badge.active {
            background: #27ae60;
            color: white;
        }

        .status-badge.inactive {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
        }
    </style>
</head>
<body>
<div class="display-area">
    <!-- å–¶æ¥­æ™‚é–“å‰ãƒãƒŠãƒ¼ -->
    <div id="openingSoonBanner" class="lunch-break-banner">ğŸ• 10æ™‚ã«çª“å£ãŒé–‹ãã¾ã™ã€€ãŠå¾…ã¡ä¸‹ã•ã„</div>

    <!-- æ˜¼ä¼‘ã¿ãƒãƒŠãƒ¼ -->
    <div id="lunchBreakBanner" class="lunch-break-banner">ğŸ• æ˜¼ä¼‘ã¿ä¸­ã€€åˆå¾Œï¼“æ™‚ã‚ˆã‚Šçª“å£ãŒé–‹ãã¾ã™</div>

    <!-- QRã‚³ãƒ¼ãƒ‰ï¼ˆå·¦ä¸‹å›ºå®šï¼‰ -->
    <div id="qrCodeCorner" class="qr-code-corner" style="display: none;">
        <img src="Downloads/QR_fujiminohikari.png" alt="äºˆç´„QRã‚³ãƒ¼ãƒ‰">
    </div>

    <div id="displayContainer" class="display-container loading">
        <div class="icon">â³</div>
        <div class="main-message">èª­ã¿è¾¼ã¿ä¸­...</div>
        <div class="sub-message">äºˆç´„æ™‚é–“æ ã‚’ç¢ºèªã—ã¦ã„ã¾ã™</div>
    </div>
</div>

<!-- ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«éè¡¨ç¤ºãƒœã‚¿ãƒ³ -->
<div id="togglePanel" class="toggle-panel">ğŸ› ï¸ ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«</div>

<!-- ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
<div id="debugPanel" class="debug-panel">
    <h2>ğŸ› ï¸ ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h2>

    <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ -->
    <h3>ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ</h3>
    <div>
        <span id="modeDebug" class="status-badge active">ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰</span>
        <span id="modeProduction" class="status-badge inactive">æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰</span>
    </div>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ‡ã‚Šæ›¿ãˆ -->
    <h3>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
    <div>
        <span id="statusAvailable" class="status-badge active">ç©ºãã‚ã‚Š</span>
        <span id="statusFull" class="status-badge inactive">æº€æ </span>
        <span id="statusClosed" class="status-badge inactive">ä¼‘è¨ºæ—¥</span>
        <span id="statusError" class="status-badge inactive">ã‚¨ãƒ©ãƒ¼</span>
    </div>

    <!-- æ™‚é–“æ ãƒ‡ãƒ¼ã‚¿ -->
    <h3>æ™‚é–“æ ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONå½¢å¼ï¼‰</h3>
    <label for="slotsInput">ç©ºãæ™‚é–“æ ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
    <input type="text" id="slotsInput" value="10:15,11:30,14:00,15:45" placeholder="ä¾‹: 10:15,11:30,14:00">

    <label for="displayTextInput">è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ</label>
    <select id="displayTextInput">
        <option value="æœ¬æ—¥">æœ¬æ—¥</option>
        <option value="æ˜æ—¥">æ˜æ—¥</option>
        <option value="æœ¨æ›œ">æœ¨æ›œ</option>
        <option value="æ¬¡ã®è¨ºç™‚æ—¥">æ¬¡ã®è¨ºç™‚æ—¥</option>
    </select>

    <!-- æ™‚é–“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <h3>æ™‚é–“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h3>
    <label for="simulateHour">æ™‚åˆ»ï¼ˆæ™‚ï¼‰</label>
    <input type="number" id="simulateHour" min="0" max="23" value="10">

    <label for="simulateMinute">æ™‚åˆ»ï¼ˆåˆ†ï¼‰</label>
    <input type="number" id="simulateMinute" min="0" max="59" value="30">

    <label for="simulateDay">æ›œæ—¥</label>
    <select id="simulateDay">
        <option value="0">æ—¥æ›œæ—¥</option>
        <option value="1" selected>æœˆæ›œæ—¥</option>
        <option value="2">ç«æ›œæ—¥</option>
        <option value="3">æ°´æ›œæ—¥</option>
        <option value="4">æœ¨æ›œæ—¥</option>
        <option value="5">é‡‘æ›œæ—¥</option>
        <option value="6">åœŸæ›œæ—¥</option>
    </select>

    <button onclick="applyTimeSimulation()">æ™‚é–“ã‚’é©ç”¨</button>

    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º -->
    <h3>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</h3>
    <label for="availableMsg">ç©ºãã‚ã‚Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
    <input type="text" id="availableMsg" value="å—ä»˜çª“å£ã§ã”æ¡ˆå†…ã§ãã¾ã™ã€‚ã‚‚ã—ãã¯Webäºˆç´„ã‚‚å¯èƒ½ã§ã™ã€‚">

    <label for="fullMsg">æº€æ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
    <input type="text" id="fullMsg" value="æ¬¡ã®è¨ºç™‚æ—¥ä»¥é™ã§ã”äºˆç´„ãã ã•ã„">

    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <h3>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
    <button onclick="updateDisplay()">è¡¨ç¤ºã‚’æ›´æ–°</button>
    <button class="secondary" onclick="resetToDefault()">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™</button>
    <button class="danger" onclick="clearLocalStorage()">è¨­å®šã‚’ã‚¯ãƒªã‚¢</button>

    <!-- æœ¬ç•ªãƒ‡ãƒ¼ã‚¿å–å¾— -->
    <h3>æœ¬ç•ªãƒ‡ãƒ¼ã‚¿</h3>
    <button onclick="fetchProductionData()">Cloud Storageã‹ã‚‰å–å¾—</button>
    <p id="lastFetchTime" style="font-size: 12px; color: #999; margin-top: 5px;"></p>
</div>

<script>
    // Cloud Storageã®URL
    const API_URL = 'https://storage.googleapis.com/reservation-timeslots-fujiminohikari/timeslots.json';

    // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹
    let debugState = {
        isDebugMode: true,
        status: 'available', // available, full, closed, error
        slots: ['10:15', '11:30', '14:00', '15:45'],
        displayText: 'æœ¬æ—¥',
        simulatedTime: null,
        messages: {
            available: 'å—ä»˜çª“å£ã§ã”æ¡ˆå†…ã§ãã¾ã™ã€‚ã‚‚ã—ãã¯Webäºˆç´„ã‚‚å¯èƒ½ã§ã™ã€‚',
            full: 'æ¬¡ã®è¨ºç™‚æ—¥ä»¥é™ã§ã”äºˆç´„ãã ã•ã„'
        }
    };

    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', () => {
        loadDebugState();
        setupEventListeners();
        updateDisplay();
    });

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
    function setupEventListeners() {
        // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        document.getElementById('modeDebug').addEventListener('click', () => {
            debugState.isDebugMode = true;
            updateModeUI();
            updateDisplay();
        });

        document.getElementById('modeProduction').addEventListener('click', () => {
            debugState.isDebugMode = false;
            updateModeUI();
            fetchProductionData();
        });

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ‡ã‚Šæ›¿ãˆ
        document.getElementById('statusAvailable').addEventListener('click', () => {
            debugState.status = 'available';
            updateStatusUI();
            updateDisplay();
        });

        document.getElementById('statusFull').addEventListener('click', () => {
            debugState.status = 'full';
            updateStatusUI();
            updateDisplay();
        });

        document.getElementById('statusClosed').addEventListener('click', () => {
            debugState.status = 'closed';
            updateStatusUI();
            updateDisplay();
        });

        document.getElementById('statusError').addEventListener('click', () => {
            debugState.status = 'error';
            updateStatusUI();
            updateDisplay();
        });

        // ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«è¡¨ç¤º/éè¡¨ç¤º
        document.getElementById('togglePanel').addEventListener('click', () => {
            const panel = document.getElementById('debugPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        });
    }

    // ãƒ¢ãƒ¼ãƒ‰UIæ›´æ–°
    function updateModeUI() {
        document.getElementById('modeDebug').className = debugState.isDebugMode ? 'status-badge active' : 'status-badge inactive';
        document.getElementById('modeProduction').className = !debugState.isDebugMode ? 'status-badge active' : 'status-badge inactive';
    }

    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹UIæ›´æ–°
    function updateStatusUI() {
        document.getElementById('statusAvailable').className = debugState.status === 'available' ? 'status-badge active' : 'status-badge inactive';
        document.getElementById('statusFull').className = debugState.status === 'full' ? 'status-badge active' : 'status-badge inactive';
        document.getElementById('statusClosed').className = debugState.status === 'closed' ? 'status-badge active' : 'status-badge inactive';
        document.getElementById('statusError').className = debugState.status === 'error' ? 'status-badge active' : 'status-badge inactive';
    }

    // ãƒ‡ãƒãƒƒã‚°çŠ¶æ…‹ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
    function loadDebugState() {
        const saved = localStorage.getItem('timeslotDebugState');
        if (saved) {
            debugState = { ...debugState, ...JSON.parse(saved) };

            // UIã«åæ˜ 
            document.getElementById('slotsInput').value = debugState.slots.join(',');
            document.getElementById('displayTextInput').value = debugState.displayText;
            document.getElementById('availableMsg').value = debugState.messages.available;
            document.getElementById('fullMsg').value = debugState.messages.full;
        }
        updateModeUI();
        updateStatusUI();
    }

    // ãƒ‡ãƒãƒƒã‚°çŠ¶æ…‹ã‚’ä¿å­˜
    function saveDebugState() {
        localStorage.setItem('timeslotDebugState', JSON.stringify(debugState));
    }

    // æ™‚é–“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
    function applyTimeSimulation() {
        const hour = parseInt(document.getElementById('simulateHour').value);
        const minute = parseInt(document.getElementById('simulateMinute').value);
        const day = parseInt(document.getElementById('simulateDay').value);

        debugState.simulatedTime = { hour, minute, day };
        updateBanners();
        alert(`æ™‚é–“ã‚’ ${hour}:${String(minute).padStart(2, '0')} ã«è¨­å®šã—ã¾ã—ãŸ`);
    }

    // å–¶æ¥­æ™‚é–“å‰åˆ¤å®šé–¢æ•°
    function isOpeningSoon() {
        if (debugState.simulatedTime) {
            const { hour, day } = debugState.simulatedTime;
            if (day === 3) return false; // æ°´æ›œæ—¥
            return hour >= 8 && hour < 10;
        }

        const now = new Date();
        const dayOfWeek = now.getDay();
        const hour = now.getHours();

        if (dayOfWeek === 3) return false;
        return hour >= 8 && hour < 10;
    }

    // æ˜¼ä¼‘ã¿åˆ¤å®šé–¢æ•°
    function isLunchBreak() {
        if (debugState.simulatedTime) {
            const { hour, minute, day } = debugState.simulatedTime;
            if (day === 3) return false; // æ°´æ›œæ—¥
            return (hour === 13 && minute >= 30) || (hour === 14);
        }

        const now = new Date();
        const dayOfWeek = now.getDay();
        const hour = now.getHours();
        const minute = now.getMinutes();

        if (dayOfWeek === 3) return false;
        return (hour === 13 && minute >= 30) || (hour === 14);
    }

    // ãƒãƒŠãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’æ›´æ–°
    function updateBanners() {
        const openingSoonBanner = document.getElementById('openingSoonBanner');
        const lunchBreakBanner = document.getElementById('lunchBreakBanner');

        if (isOpeningSoon()) {
            openingSoonBanner.classList.add('show');
        } else {
            openingSoonBanner.classList.remove('show');
        }

        if (isLunchBreak()) {
            lunchBreakBanner.classList.add('show');
        } else {
            lunchBreakBanner.classList.remove('show');
        }
    }

    // è¡¨ç¤ºã‚’æ›´æ–°
    function updateDisplay() {
        if (debugState.isDebugMode) {
            // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ï¼šæ‰‹å‹•è¨­å®šãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
            updateDebugDisplay();
        } else {
            // æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ï¼šè‡ªå‹•æ›´æ–°
            fetchProductionData();
        }

        saveDebugState();
    }

    // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º
    function updateDebugDisplay() {
        // å…¥åŠ›ã‹ã‚‰å€¤ã‚’å–å¾—
        const slotsInput = document.getElementById('slotsInput').value;
        debugState.slots = slotsInput ? slotsInput.split(',').map(s => s.trim()) : [];
        debugState.displayText = document.getElementById('displayTextInput').value;
        debugState.messages.available = document.getElementById('availableMsg').value;
        debugState.messages.full = document.getElementById('fullMsg').value;

        const container = document.getElementById('displayContainer');
        const formattedTime = formatTimestamp(new Date().toISOString());

        // ãƒãƒŠãƒ¼ã‚’æ›´æ–°
        updateBanners();

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«å¿œã˜ã¦è¡¨ç¤º
        if (debugState.status === 'available') {
            const timeslotsText = debugState.slots.length > 0 ? debugState.slots.join('ãƒ»') : 'ï¼ˆæ™‚é–“æ ãªã—ï¼‰';

            container.className = 'display-container available';
            container.innerHTML = `
                <div class="icon">ğŸ•</div>
                <div class="main-message">${debugState.displayText}ã®äºˆç´„</div>
                <div class="timeslots">${timeslotsText}</div>
                <div class="sub-message">ãŒç©ºã„ã¦ã„ã¾ã™</div>
                <div class="qr-message">${debugState.messages.available}</div>
                <div class="update-time">${formattedTime}</div>
            `;

            // QRã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
            document.getElementById('qrCodeCorner').style.display = 'block';

        } else if (debugState.status === 'full' || debugState.status === 'closed') {
            const message = debugState.status === 'full' ? 'æº€æ ' : 'ä¼‘è¨ºæ—¥';
            const subMessage = debugState.status === 'full' ? 'å¤§å¤‰ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“' : 'æœ¬æ—¥ã¯ä¼‘è¨ºæ—¥ã§ã™';

            container.className = 'display-container unavailable';
            container.innerHTML = `
                <div class="icon">ğŸ˜”</div>
                <div class="main-message">${debugState.displayText}ã®äºˆç´„ã¯<br>ã€Œ${message}ã€ã§ã™</div>
                <div class="sub-message">${subMessage}</div>
                <div class="qr-message">${debugState.messages.full}</div>
                <div class="update-time">${formattedTime}</div>
            `;

            // QRã‚³ãƒ¼ãƒ‰ã‚’éè¡¨ç¤º
            document.getElementById('qrCodeCorner').style.display = 'none';

        } else if (debugState.status === 'error') {
            container.className = 'display-container error';
            container.innerHTML = `
                <div class="icon">âš ï¸</div>
                <div class="main-message">æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“</div>
                <div class="error-message">ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„</div>
            `;

            // QRã‚³ãƒ¼ãƒ‰ã‚’éè¡¨ç¤º
            document.getElementById('qrCodeCorner').style.display = 'none';
        }
    }

    // æœ¬ç•ªãƒ‡ãƒ¼ã‚¿å–å¾—
    async function fetchProductionData() {
        const container = document.getElementById('displayContainer');

        try {
            const response = await fetch(API_URL);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            // ãƒãƒŠãƒ¼ã‚’æ›´æ–°
            updateBanners();

            // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
            const formattedTime = formatTimestamp(data.updatedAt);

            // æ™‚é–“æ ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            const hasSlots = data.slots && data.slots.length > 0;

            if (hasSlots) {
                const timeslotsText = data.slots.join('ãƒ»');

                container.className = 'display-container available';
                container.innerHTML = `
                    <div class="icon">ğŸ•</div>
                    <div class="main-message">${data.displayText}ã®äºˆç´„</div>
                    <div class="timeslots">${timeslotsText}</div>
                    <div class="sub-message">ãŒç©ºã„ã¦ã„ã¾ã™</div>
                    <div class="qr-message">å—ä»˜çª“å£ã§ã”æ¡ˆå†…ã§ãã¾ã™ã€‚ã‚‚ã—ãã¯Webäºˆç´„ã‚‚å¯èƒ½ã§ã™ã€‚</div>
                    <div class="update-time">${formattedTime}</div>
                `;

                document.getElementById('qrCodeCorner').style.display = 'block';

            } else {
                let message = 'æº€æ ';
                let subMessage = 'å¤§å¤‰ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“';

                if (data.status === 'closed') {
                    message = 'ä¼‘è¨ºæ—¥';
                    subMessage = 'æœ¬æ—¥ã¯ä¼‘è¨ºæ—¥ã§ã™';
                }

                container.className = 'display-container unavailable';
                container.innerHTML = `
                    <div class="icon">ğŸ˜”</div>
                    <div class="main-message">${data.displayText}ã®äºˆç´„ã¯<br>ã€Œ${message}ã€ã§ã™</div>
                    <div class="sub-message">${subMessage}</div>
                    <div class="qr-message">æ¬¡ã®è¨ºç™‚æ—¥ä»¥é™ã§ã”äºˆç´„ãã ã•ã„</div>
                    <div class="update-time">${formattedTime}</div>
                `;

                document.getElementById('qrCodeCorner').style.display = 'none';
            }

            document.getElementById('lastFetchTime').textContent = `æœ€çµ‚å–å¾—: ${new Date().toLocaleTimeString('ja-JP')}`;

        } catch (error) {
            console.error('ã‚¨ãƒ©ãƒ¼:', error);
            displayError();
        }
    }

    // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
    function displayError() {
        const container = document.getElementById('displayContainer');
        container.className = 'display-container error';
        container.innerHTML = `
            <div class="icon">âš ï¸</div>
            <div class="main-message">æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“</div>
            <div class="error-message">ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„</div>
        `;

        document.getElementById('qrCodeCorner').style.display = 'none';
    }

    // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    function formatTimestamp(isoString) {
        const date = new Date(isoString);

        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');

        return `æ›´æ–°ï¼š${year}/${month}/${day} ${hours}:${minutes}`;
    }

    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
    function resetToDefault() {
        debugState = {
            isDebugMode: true,
            status: 'available',
            slots: ['10:15', '11:30', '14:00', '15:45'],
            displayText: 'æœ¬æ—¥',
            simulatedTime: null,
            messages: {
                available: 'å—ä»˜çª“å£ã§ã”æ¡ˆå†…ã§ãã¾ã™ã€‚ã‚‚ã—ãã¯Webäºˆç´„ã‚‚å¯èƒ½ã§ã™ã€‚',
                full: 'æ¬¡ã®è¨ºç™‚æ—¥ä»¥é™ã§ã”äºˆç´„ãã ã•ã„'
            }
        };

        document.getElementById('slotsInput').value = debugState.slots.join(',');
        document.getElementById('displayTextInput').value = debugState.displayText;
        document.getElementById('availableMsg').value = debugState.messages.available;
        document.getElementById('fullMsg').value = debugState.messages.full;
        document.getElementById('simulateHour').value = 10;
        document.getElementById('simulateMinute').value = 30;
        document.getElementById('simulateDay').value = 1;

        updateModeUI();
        updateStatusUI();
        updateDisplay();

        alert('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã«æˆ»ã—ã¾ã—ãŸ');
    }

    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
    function clearLocalStorage() {
        if (confirm('ã™ã¹ã¦ã®è¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
            localStorage.removeItem('timeslotDebugState');
            alert('è¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚');
            location.reload();
        }
    }
</script>

</body>
</html>
