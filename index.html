<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºˆç´„çŠ¶æ³ãƒãƒŠãƒ¼</title>
    <style>
        /* ãƒãƒŠãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .reservation-banner {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        /* ãƒ›ãƒãƒ¼æ™‚ã®åŠ¹æœ */
        .reservation-banner:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        /* äºˆç´„å¯èƒ½ã®æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .reservation-banner.available {
            background: #0056B3;
            color: white;
            border: 3px solid #004085;
        }

        /* äºˆç´„ä¸å¯ã®æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .reservation-banner.unavailable {
            background: #DC3545;
            color: white;
            border: 3px solid #bd2130;
        }

        /* èª­ã¿è¾¼ã¿ä¸­ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .reservation-banner.loading {
            background: #c8d0e7;
            color: #333;
        }

        /* ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .reservation-banner h2 {
            margin: 0 0 10px 0;
            font-size: 28px;
            font-weight: bold;
        }

        /* ã‚µãƒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .reservation-banner p {
            margin: 5px 0;
            font-size: 18px;
            opacity: 0.9;
        }

        /* è£œè¶³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .reservation-banner .note {
            margin: 10px 0;
            font-size: 14px;
            opacity: 0.85;
        }

        /* æ›´æ–°æ™‚åˆ» */
        .reservation-banner .update-time {
            margin-top: 15px;
            font-size: 14px;
            opacity: 0.8;
        }

        /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .reservation-banner.error {
            background: #f5f5f5;
            color: #666;
            border: 2px dashed #ccc;
        }

        /* ã‚¹ãƒãƒ›å¯¾å¿œ */
        @media (max-width: 600px) {
            .reservation-banner {
                margin: 10px;
                padding: 15px;
            }
            
            .reservation-banner h2 {
                font-size: 22px;
            }
            
            .reservation-banner p {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>

<!-- äºˆç´„çŠ¶æ³ãƒãƒŠãƒ¼ -->
<div id="reservationBanner" class="reservation-banner loading">
    <h2>èª­ã¿è¾¼ã¿ä¸­...</h2>
    <p>äºˆç´„çŠ¶æ³ã‚’ç¢ºèªã—ã¦ã„ã¾ã™</p>
</div>

<script>
    // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ID
    const SPREADSHEET_ID = '1RSd9aC5B_-gQ1_j5V1aQcZn1iVw9v8mpmhJ78_8gY80';
    
    // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã‚·ãƒ¼ãƒˆå
    const SHEET_NAME = 'ãƒ•ã‚©ãƒ¼ãƒ ã®å›ç­” 1';
    
    // Google Sheets APIã®URL
    const API_URL = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;

    /**
     * äºˆç´„çŠ¶æ³ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹é–¢æ•°
     */
    async function updateReservationStatus() {
        const banner = document.getElementById('reservationBanner');
        
        try {
            // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const response = await fetch(API_URL);
            const text = await response.text();
            
            // JSONãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºï¼ˆGoogleç‰¹æœ‰ã®å½¢å¼ï¼‰
            const json = JSON.parse(text.substring(47).slice(0, -2));
            
            // ãƒ‡ãƒ¼ã‚¿ã®è¡Œã‚’å–å¾—
            const rows = json.table.rows;
            
            if (rows.length === 0) {
                throw new Error('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
            }
            
            // å…¨ã¦ã®è¡Œã‹ã‚‰æœ€æ–°ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æ¢ã™
            let latestRow = null;
            let latestDate = null;
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                if (row.c && row.c[0] && row.c[0].v) {
                    // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
                    const timestampStr = row.c[0].f || row.c[0].v;
                    const date = new Date(timestampStr);
                    
                    if (!latestDate || date > latestDate) {
                        latestDate = date;
                        latestRow = row;
                    }
                }
            }
            
            if (!latestRow) {
                throw new Error('æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
            }
            
            const timestamp = latestRow.c[0].f; // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ï¼‰
            const status = latestRow.c[1].v; // äºˆç´„çŠ¶æ³ï¼ˆã€Œç©ºãã‚ã‚Šã€orã€Œã€Œæº€ã€ã€ï¼‰
            
            // ç¾åœ¨æ™‚åˆ»ã‚’å–å¾—
            const now = new Date();
            const currentHour = now.getHours();
            
            // 18æ™‚ä»¥é™ã‹ã©ã†ã‹ã‚’åˆ¤å®š
            const isAfter18 = currentHour >= 18;
            
            // äºˆç´„å¯èƒ½ã‹ã©ã†ã‹ã‚’åˆ¤å®šï¼ˆã€Œç©ºãã‚ã‚Šã€ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼‰
            const isAvailable = status.includes('ç©ºãã‚ã‚Š');
            
            // ãƒãƒŠãƒ¼ã‚’æ›´æ–°
            displayBanner(isAvailable, isAfter18, timestamp);
            
        } catch (error) {
            console.error('ã‚¨ãƒ©ãƒ¼:', error);
            displayError();
        }
    }

    /**
     * ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã€Œæ›´æ–°ï¼šYYYY/MM/DD HH:MMã€å½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
     */
    function formatTimestamp(timestampStr) {
        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ãƒ‘ãƒ¼ã‚¹
        const date = new Date(timestampStr);
        
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        
        return `æ›´æ–°ï¼š${year}/${month}/${day} ${hours}:${minutes}`;
    }

    /**
     * ãƒãƒŠãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
     */
    function displayBanner(isAvailable, isAfter18, updateTime) {
        const banner = document.getElementById('reservationBanner');

        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã§åˆ¤å®š
        const now = new Date(updateTime);
        const dayOfWeek = now.getDay(); // 0=æ—¥, 1=æœˆ, 2=ç«, 3=æ°´...
        const hour = now.getHours();
        const minute = now.getMinutes();
        const isAfter1830 = (hour > 18) || (hour === 18 && minute >= 30);
        
        // è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆã‚’æ±ºå®š
        let dayText = 'æœ¬æ—¥';
        
        if (isAfter1830) {
            // 18:30ä»¥é™
            
            // æœˆæœ«ãƒã‚§ãƒƒã‚¯
            const lastDayOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            if (now.getDate() === lastDayOfMonth) {
                dayText = 'ç¿Œè¨ºç™‚æ—¥';
            } else if (dayOfWeek === 2) {
                // ç«æ›œæ—¥
                dayText = 'æœ¨æ›œ';
            } else {
                dayText = 'æ˜æ—¥';
            }
        } else {
            // 18:30ã‚ˆã‚Šå‰
            if (dayOfWeek === 3) {
                // æ°´æ›œæ—¥
                dayText = 'æœ¨æ›œ';
            } else {
                dayText = 'æœ¬æ—¥';
            }
        }
        
        // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        const formattedTime = formatTimestamp(updateTime);
        
        if (isAvailable) {
            // äºˆç´„å¯èƒ½
            banner.className = 'reservation-banner available';
            banner.innerHTML = `
                <h2>âœ… ${dayText}åˆ†ã®äºˆç´„æ  ç©ºãã‚ã‚Š</h2>
                <p>ã”äºˆç´„ã„ãŸã ã‘ã¾ã™</p>
                <p>ã‚¯ãƒªãƒƒã‚¯ã—ã¦äºˆç´„ãƒšãƒ¼ã‚¸ã¸</p>
                <div class="update-time">${formattedTime}</div>
            `;
        } else {
            // äºˆç´„ä¸å¯
            banner.className = 'reservation-banner unavailable';
            banner.innerHTML = `
                <h2>ğŸ˜” ${dayText}ã®äºˆç´„ã¯ æº€æ ã§ã™</h2>
                <p>èª ã«æã‚Œå…¥ã‚Šã¾ã™ãŒã€ç¿Œè¨ºç™‚æ—¥ä»¥é™ã§ ã”äºˆç´„ãã ã•ã„</p>
                <p>ã‚¯ãƒªãƒƒã‚¯ã—ã¦ äºˆç´„ãƒšãƒ¼ã‚¸ã¸</p>
                <div class="update-time">${formattedTime}</div>
            `;
        }
    }

    /**
     * ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã™ã‚‹é–¢æ•°
     */
    function displayError() {
        const banner = document.getElementById('reservationBanner');
        banner.className = 'reservation-banner error';
        banner.innerHTML = `
            <h2>âš ï¸ æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“</h2>
            <p>ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„</p>
        `;
    }

    // ãƒãƒŠãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã®å‡¦ç†
    document.getElementById('reservationBanner').addEventListener('click', function() {
        window.open('https://ckreserve.com/clinic/fujiminohikari-ganka', '_blank');
    });

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
    updateReservationStatus();
    
    // 1åˆ†ã”ã¨ã«è‡ªå‹•æ›´æ–°ï¼ˆ60000ãƒŸãƒªç§’ = 1åˆ†ï¼‰
    setInterval(updateReservationStatus, 60000);
</script>

</body>
</html>
